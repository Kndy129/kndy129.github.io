<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Certificações - Login</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  
  <!-- reCAPTCHA -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      color: #fff;
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      width: 100%;
      max-width: 450px;
      padding: 20px;
    }

    .auth-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }

    .auth-card:hover {
      transform: translateY(-5px);
    }

    .logo {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .tagline {
      text-align: center;
      font-size: 1.2rem;
      margin-bottom: 30px;
      opacity: 0.9;
    }

    .auth-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .auth-tab {
      flex: 1;
      text-align: center;
      padding: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
    }

    .auth-tab.active {
      border-bottom: 3px solid #ff6b6b;
      font-weight: 600;
    }

    .auth-form {
      display: none;
    }

    .auth-form.active {
      display: block;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: none;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.15);
      color: white;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.25);
      box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.5);
    }

    .form-control::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .password-strength {
      height: 5px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
      margin-top: 5px;
      overflow: hidden;
    }

    .password-strength-bar {
      height: 100%;
      width: 0%;
      border-radius: 3px;
      transition: width 0.3s ease, background-color 0.3s ease;
    }

    .password-requirements {
      margin-top: 5px;
      font-size: 0.85rem;
      opacity: 0.8;
    }

    .requirement {
      display: flex;
      align-items: center;
      margin-bottom: 3px;
    }

    .requirement.valid {
      color: #4CAF50;
    }

    .requirement.invalid {
      color: #ff5252;
    }

    .requirement-icon {
      margin-right: 5px;
      font-size: 0.8rem;
    }

    .btn {
      display: block;
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #ff6b6b;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    .btn:hover {
      background: #ff5252;
      transform: translateY(-2px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-google {
      background: #4285F4;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .btn-google:hover {
      background: #357ae8;
    }

    .google-icon {
      width: 18px;
      height: 18px;
    }

    .divider {
      display: flex;
      align-items: center;
      margin: 20px 0;
    }

    .divider-line {
      flex: 1;
      height: 1px;
      background: rgba(255, 255, 255, 0.2);
    }

    .divider-text {
      padding: 0 15px;
      font-size: 0.9rem;
      opacity: 0.7;
    }

    .auth-links {
      text-align: center;
      margin-top: 20px;
    }

    .auth-link {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: color 0.3s ease;
      display: inline-block;
      margin: 0 10px;
    }

    .auth-link:hover {
      color: white;
      text-decoration: underline;
    }

    .message {
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      display: none;
    }

    .message.success {
      background: rgba(76, 175, 80, 0.2);
      border: 1px solid rgba(76, 175, 80, 0.5);
      display: block;
    }

    .message.error {
      background: rgba(244, 67, 54, 0.2);
      border: 1px solid rgba(244, 67, 54, 0.5);
      display: block;
    }

    .home-link {
      text-align: center;
      margin-top: 20px;
    }

    .home-link a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .home-link a:hover {
      color: white;
      text-decoration: underline;
    }

    /* Estilos para o reCAPTCHA */
    .g-recaptcha {
      display: flex;
      justify-content: center;
      margin: 15px 0;
      transform: scale(0.95);
      transform-origin: center;
    }

    .g-recaptcha > div {
      border-radius: 8px;
      overflow: hidden;
    }

    .recaptcha-error {
      color: #ff5252;
      font-size: 0.85rem;
      text-align: center;
      margin-top: 5px;
      display: none;
    }

    @media (max-width: 480px) {
      .container {
        padding: 15px;
      }
      
      .auth-card {
        padding: 20px;
      }
      
      .logo {
        font-size: 2rem;
      }
      
      .tagline {
        font-size: 1rem;
      }

      .g-recaptcha {
        transform: scale(0.85);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="auth-card">
      <h1 class="logo">Simulador de Certificações</h1>
      <p class="tagline">Prepare-se para suas certificações de cibersegurança</p>
      
      <div class="auth-tabs">
        <div class="auth-tab active" data-tab="login">Login</div>
        <div class="auth-tab" data-tab="register">Cadastro</div>
      </div>
      
      <div id="message" class="message"></div>
      
      <!-- Formulário de Login -->
      <form id="login-form" class="auth-form active">
        <div class="form-group">
          <label for="login-email">E-mail</label>
          <input type="email" id="login-email" class="form-control" placeholder="Seu e-mail" required>
        </div>
        
        <div class="form-group">
          <label for="login-password">Senha</label>
          <input type="password" id="login-password" class="form-control" placeholder="Sua senha" required>
        </div>
        
        <!-- reCAPTCHA Login -->
        <div class="form-group">
          <div class="g-recaptcha" id="login-recaptcha" data-sitekey="6Lf9fuUrAAAAAIU24RwrFfVyIR50BoB_dC8tOs2e"></div>
          <div class="recaptcha-error" id="login-recaptcha-error">Por favor, complete o reCAPTCHA</div>
        </div>
        
        <button type="submit" class="btn">Entrar</button>
        
        <div class="divider">
          <div class="divider-line"></div>
          <div class="divider-text">ou</div>
          <div class="divider-line"></div>
        </div>
        
        <button type="button" class="btn btn-google" id="google-login">
          <svg class="google-icon" viewBox="0 0 24 24">
            <path fill="#fff" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path fill="#fff" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
            <path fill="#fff" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
            <path fill="#fff" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
          </svg>
          Entrar com Google
        </button>
        
        <div class="auth-links">
          <a href="#" class="auth-link" id="forgot-password">Esqueceu a senha?</a>
        </div>
      </form>
      
      <!-- Formulário de Cadastro -->
      <form id="register-form" class="auth-form">
        <div class="form-group">
          <label for="register-email">E-mail</label>
          <input type="email" id="register-email" class="form-control" placeholder="Seu e-mail" required>
        </div>
        
        <div class="form-group">
          <label for="register-birthdate">Data de Nascimento</label>
          <input type="date" id="register-birthdate" class="form-control" required>
        </div>
        
        <div class="form-group">
          <label for="register-password">Senha</label>
          <input type="password" id="register-password" class="form-control" placeholder="Crie uma senha" required>
          <div class="password-strength">
            <div class="password-strength-bar" id="password-strength-bar"></div>
          </div>
          <div class="password-requirements" id="password-requirements">
            <div class="requirement invalid" id="req-length">
              <span class="requirement-icon">?</span>
              Pelo menos 8 caracteres
            </div>
            <div class="requirement invalid" id="req-uppercase">
              <span class="requirement-icon">?</span>
              Pelo menos uma letra maiúscula
            </div>
            <div class="requirement invalid" id="req-lowercase">
              <span class="requirement-icon">?</span>
              Pelo menos uma letra minúscula
            </div>
            <div class="requirement invalid" id="req-number">
              <span class="requirement-icon">?</span>
              Pelo menos um número
            </div>
            <div class="requirement invalid" id="req-special">
              <span class="requirement-icon">?</span>
              Pelo menos um caractere especial
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="register-confirm-password">Confirmar Senha</label>
          <input type="password" id="register-confirm-password" class="form-control" placeholder="Confirme sua senha" required>
          <div id="password-match" class="password-requirements" style="display: none;">
            <div class="requirement invalid">
              <span class="requirement-icon">?</span>
              As senhas não coincidem
            </div>
          </div>
        </div>
        
        <!-- reCAPTCHA Cadastro -->
        <div class="form-group">
          <div class="g-recaptcha" id="register-recaptcha" data-sitekey="6Lf9fuUrAAAAAIU24RwrFfVyIR50BoB_dC8tOs2e"></div>
          <div class="recaptcha-error" id="register-recaptcha-error">Por favor, complete o reCAPTCHA</div>
        </div>
        
        <button type="submit" class="btn">Cadastrar</button>
        
        <div class="divider">
          <div class="divider-line"></div>
          <div class="divider-text">ou</div>
          <div class="divider-line"></div>
        </div>
        
        <button type="button" class="btn btn-google" id="google-register">
          <svg class="google-icon" viewBox="0 0 24 24">
            <path fill="#fff" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path fill="#fff" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
            <path fill="#fff" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
            <path fill="#fff" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
          </svg>
          Cadastrar com Google
        </button>
      </form>
      
      <!-- Formulário de Recuperação de Senha -->
      <form id="reset-form" class="auth-form">
        <div class="form-group">
          <label for="reset-email">E-mail</label>
          <input type="email" id="reset-email" class="form-control" placeholder="Seu e-mail" required>
        </div>
        
        <button type="submit" class="btn">Enviar Link de Recuperação</button>
        
        <div class="auth-links">
          <a href="#" class="auth-link" id="back-to-login">Voltar para o login</a>
        </div>
      </form>
      
      <div class="home-link">
        <a href="login.html">Voltar para a página inicial</a>
      </div>
    </div>
  </div>

  <script>
    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDFBV9NIVTdd7FLKt1F_3Mo6KDbRfTbsjI",
      authDomain: "simulador-de-certificacoes.firebaseapp.com",
      projectId: "simulador-de-certificacoes",
      storageBucket: "simulador-de-certificacoes.firebasestorage.app",
      messagingSenderId: "1079207323365",
      appId: "1:1079207323365:web:a3a3095dd50fe256d3160c"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Elementos DOM
    const authTabs = document.querySelectorAll('.auth-tab');
    const authForms = document.querySelectorAll('.auth-form');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const resetForm = document.getElementById('reset-form');
    const messageDiv = document.getElementById('message');
    const forgotPasswordLink = document.getElementById('forgot-password');
    const backToLoginLink = document.getElementById('back-to-login');
    const googleLoginBtn = document.getElementById('google-login');
    const googleRegisterBtn = document.getElementById('google-register');
    
    // Elementos de validação de senha
    const passwordInput = document.getElementById('register-password');
    const confirmPasswordInput = document.getElementById('register-confirm-password');
    const passwordStrengthBar = document.getElementById('password-strength-bar');
    const passwordMatchDiv = document.getElementById('password-match');
    
    // Elementos reCAPTCHA
    const loginRecaptchaError = document.getElementById('login-recaptcha-error');
    const registerRecaptchaError = document.getElementById('register-recaptcha-error');

    // Função para mostrar mensagens
    function showMessage(text, type) {
      messageDiv.textContent = text;
      messageDiv.className = `message ${type}`;
      messageDiv.style.display = 'block';
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 5000);
    }

    // Função para validar reCAPTCHA
    function validateRecaptcha(formType) {
      const recaptchaResponse = grecaptcha.getResponse();
      if (!recaptchaResponse) {
        if (formType === 'login') {
          loginRecaptchaError.style.display = 'block';
        } else {
          registerRecaptchaError.style.display = 'block';
        }
        return false;
      }
      
      // Esconder erro se estiver válido
      if (formType === 'login') {
        loginRecaptchaError.style.display = 'none';
      } else {
        registerRecaptchaError.style.display = 'none';
      }
      
      return true;
    }

    // Função para resetar reCAPTCHA
    function resetRecaptcha(formType) {
      grecaptcha.reset();
      if (formType === 'login') {
        loginRecaptchaError.style.display = 'none';
      } else {
        registerRecaptchaError.style.display = 'none';
      }
    }
    
    // Alternar entre abas de autenticação
    authTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.getAttribute('data-tab');
        
        // Atualizar aba ativa
        authTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Atualizar formulário ativo
        authForms.forEach(form => form.classList.remove('active'));
        document.getElementById(`${tabName}-form`).classList.add('active');
        
        // Resetar reCAPTCHA ao trocar de aba
        resetRecaptcha(tabName);
        
        // Limpar mensagens
        messageDiv.style.display = 'none';
      });
    });
    
    // Mostrar formulário de recuperação de senha
    forgotPasswordLink.addEventListener('click', (e) => {
      e.preventDefault();
      authForms.forEach(form => form.classList.remove('active'));
      resetForm.classList.add('active');
      messageDiv.style.display = 'none';
    });
    
    // Voltar para o login
    backToLoginLink.addEventListener('click', (e) => {
      e.preventDefault();
      authForms.forEach(form => form.classList.remove('active'));
      loginForm.classList.add('active');
      authTabs.forEach(tab => tab.classList.remove('active'));
      document.querySelector('[data-tab="login"]').classList.add('active');
      messageDiv.style.display = 'none';
    });
    
    // Validação de força da senha
    passwordInput.addEventListener('input', () => {
      const password = passwordInput.value;
      
      // Verificar requisitos
      const hasMinLength = password.length >= 8;
      const hasUpperCase = /[A-Z]/.test(password);
      const hasLowerCase = /[a-z]/.test(password);
      const hasNumber = /[0-9]/.test(password);
      const hasSpecialChar = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
      
      // Atualizar indicadores visuais
      updateRequirement('req-length', hasMinLength);
      updateRequirement('req-uppercase', hasUpperCase);
      updateRequirement('req-lowercase', hasLowerCase);
      updateRequirement('req-number', hasNumber);
      updateRequirement('req-special', hasSpecialChar);
      
      // Calcular força da senha
      let strength = 0;
      if (hasMinLength) strength += 20;
      if (hasUpperCase) strength += 20;
      if (hasLowerCase) strength += 20;
      if (hasNumber) strength += 20;
      if (hasSpecialChar) strength += 20;
      
      // Atualizar barra de força
      passwordStrengthBar.style.width = `${strength}%`;
      
      // Definir cor baseada na força
      if (strength < 40) {
        passwordStrengthBar.style.backgroundColor = '#ff5252'; // Vermelho
      } else if (strength < 80) {
        passwordStrengthBar.style.backgroundColor = '#ffb142'; // Laranja
      } else {
        passwordStrengthBar.style.backgroundColor = '#4CAF50'; // Verde
      }
    });
    
    // Atualizar indicador de requisito
    function updateRequirement(id, isValid) {
      const element = document.getElementById(id);
      if (isValid) {
        element.classList.remove('invalid');
        element.classList.add('valid');
        element.querySelector('.requirement-icon').textContent = '?';
      } else {
        element.classList.remove('valid');
        element.classList.add('invalid');
        element.querySelector('.requirement-icon').textContent = '?';
      }
    }
    
    // Verificar se as senhas coincidem
    confirmPasswordInput.addEventListener('input', () => {
      const password = passwordInput.value;
      const confirmPassword = confirmPasswordInput.value;
      
      if (confirmPassword && password !== confirmPassword) {
        passwordMatchDiv.style.display = 'block';
      } else {
        passwordMatchDiv.style.display = 'none';
      }
    });
    
    // Validação do formulário de cadastro
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Validar reCAPTCHA primeiro
      if (!validateRecaptcha('register')) {
        showMessage('Por favor, complete o reCAPTCHA.', 'error');
        return;
      }
      
      const email = document.getElementById('register-email').value;
      const birthdate = document.getElementById('register-birthdate').value;
      const password = document.getElementById('register-password').value;
      const confirmPassword = document.getElementById('register-confirm-password').value;
      
      // Verificar se a senha atende aos requisitos
      const hasMinLength = password.length >= 8;
      const hasUpperCase = /[A-Z]/.test(password);
      const hasLowerCase = /[a-z]/.test(password);
      const hasNumber = /[0-9]/.test(password);
      const hasSpecialChar = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
      
      if (!hasMinLength || !hasUpperCase || !hasLowerCase || !hasNumber || !hasSpecialChar) {
        showMessage('A senha não atende a todos os requisitos de segurança.', 'error');
        resetRecaptcha('register');
        return;
      }
      
      // Verificar se as senhas coincidem
      if (password !== confirmPassword) {
        showMessage('As senhas não coincidem.', 'error');
        resetRecaptcha('register');
        return;
      }
      
      // Verificar se o usuário é maior de 16 anos
      const birthDate = new Date(birthdate);
      const today = new Date();
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      
      if (age < 16) {
        showMessage('Você deve ter pelo menos 16 anos para se cadastrar.', 'error');
        resetRecaptcha('register');
        return;
      }
      
      try {
        // Criar usuário no Firebase Auth
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        // Salvar dados adicionais no Firestore
        await db.collection('users').doc(user.uid).set({
          email: email,
          birthdate: birthdate,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        showMessage('Cadastro realizado com sucesso!', 'success');
        
        // Reset reCAPTCHA
        resetRecaptcha('register');
        
        // Limpar formulário
        registerForm.reset();
        passwordStrengthBar.style.width = '0%';
        document.querySelectorAll('.requirement').forEach(req => {
          req.classList.remove('valid');
          req.classList.add('invalid');
          req.querySelector('.requirement-icon').textContent = '?';
        });
        
        // Redirecionar para o simulador após um breve delay
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1500);
        
      } catch (error) {
        console.error('Erro no cadastro:', error);
        
        // Reset reCAPTCHA em caso de erro
        resetRecaptcha('register');
        
        // Tratamento de erros específicos do Firebase
        if (error.code === 'auth/email-already-in-use') {
          showMessage('Este e-mail já está cadastrado.', 'error');
        } else if (error.code === 'auth/invalid-email') {
          showMessage('O e-mail fornecido é inválido.', 'error');
        } else if (error.code === 'auth/weak-password') {
          showMessage('A senha é muito fraca.', 'error');
        } else {
          showMessage('Erro ao criar conta. Tente novamente.', 'error');
        }
      }
    });
    
    // Validação do formulário de login
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Validar reCAPTCHA primeiro
      if (!validateRecaptcha('login')) {
        showMessage('Por favor, complete o reCAPTCHA.', 'error');
        return;
      }
      
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      try {
        // Fazer login com Firebase Auth
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        // Atualizar último login no Firestore
        await db.collection('users').doc(user.uid).update({
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        showMessage('Login realizado com sucesso!', 'success');
        
        // Reset reCAPTCHA
        resetRecaptcha('login');
        
        // Redirecionar para o simulador após um breve delay
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1500);
        
      } catch (error) {
        console.error('Erro no login:', error);
        
        // Reset reCAPTCHA em caso de erro
        resetRecaptcha('login');
        
        // Tratamento de erros específicos do Firebase
        if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
          showMessage('E-mail ou senha incorretos.', 'error');
        } else if (error.code === 'auth/invalid-email') {
          showMessage('O e-mail fornecido é inválido.', 'error');
        } else if (error.code === 'auth/too-many-requests') {
          showMessage('Muitas tentativas de login. Tente novamente mais tarde.', 'error');
        } else {
          showMessage('Erro ao fazer login. Tente novamente.', 'error');
        }
      }
    });
    
    // Login com Google
    async function signInWithGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      
      try {
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        
        // Verificar se é um novo usuário
        if (result.additionalUserInfo.isNewUser) {
          // Salvar dados do usuário no Firestore
          await db.collection('users').doc(user.uid).set({
            email: user.email,
            name: user.displayName,
            photoURL: user.photoURL,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
            provider: 'google'
          });
        } else {
          // Atualizar último login
          await db.collection('users').doc(user.uid).update({
            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
          });
        }
        
        showMessage('Login com Google realizado com sucesso!', 'success');
        
        // Redirecionar para o simulador após um breve delay
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1500);
        
      } catch (error) {
        console.error('Erro no login com Google:', error);
        showMessage('Erro ao fazer login com Google. Tente novamente.', 'error');
      }
    }
    
    // Adicionar event listeners para login com Google
    googleLoginBtn.addEventListener('click', signInWithGoogle);
    googleRegisterBtn.addEventListener('click', signInWithGoogle);
    
    // Validação do formulário de recuperação de senha
    resetForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('reset-email').value;
      
      try {
        // Enviar e-mail de recuperação de senha
        await auth.sendPasswordResetEmail(email);
        
        showMessage('Um link de recuperação foi enviado para o seu e-mail.', 'success');
        
        // Limpar formulário
        resetForm.reset();
        
        // Voltar para o login após um breve delay
        setTimeout(() => {
          authForms.forEach(form => form.classList.remove('active'));
          loginForm.classList.add('active');
          authTabs.forEach(tab => tab.classList.remove('active'));
          document.querySelector('[data-tab="login"]').classList.add('active');
        }, 3000);
        
      } catch (error) {
        console.error('Erro na recuperação de senha:', error);
        
        if (error.code === 'auth/user-not-found') {
          showMessage('Este e-mail não está cadastrado.', 'error');
        } else if (error.code === 'auth/invalid-email') {
          showMessage('O e-mail fornecido é inválido.', 'error');
        } else {
          showMessage('Erro ao enviar e-mail de recuperação. Tente novamente.', 'error');
        }
      }
    });
    
    // Verificar se já existe um usuário logado
    auth.onAuthStateChanged((user) => {
      if (user) {
        // Se já estiver logado, redirecionar para o simulador
        window.location.href = 'simulador.html';
      }
    });
  </script>
</body>
</html>
